#include <zephyr/kernel.h>
#include <stdio.h>
#include <string.h>

#include "sleep.h"
#include "../assets/custom_fonts.h"

static bool show_sleep_screen = false;

// Beekeeb icon 96x96 - LVGL indexed 1-bit format 
static const uint8_t sleep_icon_map[] = {
    0x00, 0x00, 0x00, 0xff, /*Color of index 0 - black*/
    0xff, 0xff, 0xff, 0xff, /*Color of index 1 - white*/
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x80, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xc0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xe0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xf0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xf8, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x01, 0xfd, 0xfc, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x03, 0xf8, 0xfe, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x07, 0xf0, 0x7f, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x3f, 0x80, 0x00,
    0x00, 0x00, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x3f, 0xc0, 0x00,
    0x00, 0x00, 0x00, 0x7c, 0x03, 0xe0, 0x00, 0x3f, 0xf0, 0x7f, 0xe0, 0x00,
    0x00, 0x00, 0x00, 0x7c, 0x3f, 0xfe, 0x00, 0x7f, 0xf8, 0xff, 0xf0, 0x00,
    0x00, 0x00, 0x00, 0x7d, 0xff, 0xff, 0xc0, 0xff, 0xfd, 0xff, 0xf8, 0x00,
    0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xf1, 0xfc, 0xff, 0xf9, 0xfc, 0x00,
    0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xfb, 0xf8, 0x7f, 0xf0, 0xfe, 0x00,
    0x00, 0x00, 0x00, 0x7f, 0xfe, 0x3f, 0xff, 0xf0, 0x3f, 0xe0, 0x7f, 0x00,
    0x00, 0x03, 0xff, 0xff, 0xe0, 0x03, 0xff, 0xe0, 0x1f, 0xc0, 0x3f, 0x00,
    0x00, 0x03, 0xff, 0xff, 0x80, 0x00, 0xff, 0xf0, 0x3f, 0xe0, 0x7f, 0x00,
    0x00, 0x03, 0xff, 0xfe, 0x00, 0x00, 0x7f, 0xf8, 0x7f, 0xf0, 0xfe, 0x00,
    0x00, 0x03, 0xff, 0xfc, 0x00, 0x00, 0x7f, 0xfc, 0xff, 0xf9, 0xfc, 0x00,
    0x00, 0x01, 0xff, 0xf8, 0x00, 0x00, 0xfe, 0xff, 0xfd, 0xff, 0xf8, 0x00,
    0x00, 0x00, 0x03, 0xf0, 0x00, 0x01, 0xfc, 0x7f, 0xf8, 0xff, 0xf0, 0x00,
    0x00, 0x00, 0x07, 0xe0, 0x00, 0x03, 0xf8, 0x3f, 0xf0, 0x7f, 0xe0, 0x00,
    0x00, 0x00, 0x07, 0xe0, 0x00, 0x07, 0xf0, 0x1f, 0xe0, 0x3f, 0xc0, 0x00,
    0x00, 0x00, 0x07, 0xc0, 0x00, 0x0f, 0xf0, 0x1f, 0xe0, 0x3f, 0xc0, 0x00,
    0x00, 0x00, 0x0f, 0xc0, 0x00, 0x1f, 0xf8, 0x3f, 0xf0, 0x7f, 0xe0, 0x00,
    0x00, 0x00, 0x0f, 0x80, 0x00, 0x3f, 0xfc, 0x7f, 0xf8, 0xff, 0xf0, 0x00,
    0x00, 0x00, 0x0f, 0x80, 0x00, 0x7f, 0xfe, 0xff, 0xfd, 0xff, 0xf8, 0x00,
    0x00, 0x00, 0x0f, 0x80, 0x00, 0xfe, 0x7f, 0xfc, 0xff, 0xf9, 0xfc, 0x00,
    0x00, 0x00, 0x1f, 0x00, 0x01, 0xfc, 0x3f, 0xf8, 0x7f, 0xf0, 0xfe, 0x00,
    0x00, 0x00, 0x1f, 0x00, 0x03, 0xf8, 0x1f, 0xf0, 0x3f, 0xe0, 0x7f, 0x00,
    0x00, 0x00, 0x1f, 0x00, 0x07, 0xf0, 0x0f, 0xe0, 0x1f, 0xc0, 0x3f, 0x00,
    0x00, 0x00, 0x1f, 0x00, 0x0f, 0xf8, 0x1f, 0xf0, 0x3f, 0xe0, 0x7f, 0x00,
    0x00, 0x00, 0x1f, 0x00, 0x1f, 0xfc, 0x3f, 0xf8, 0x7f, 0xf0, 0xfe, 0x00,
    0x00, 0x00, 0x0f, 0x80, 0x3f, 0xfe, 0x7f, 0xfc, 0xff, 0xf9, 0xfc, 0x00,
    0x00, 0x00, 0x0f, 0x80, 0x7f, 0x7f, 0xfe, 0xff, 0xff, 0xff, 0xf8, 0x00,
    0x00, 0x00, 0x0f, 0x80, 0xfe, 0x3f, 0xfc, 0x7f, 0xff, 0xff, 0xf0, 0x00,
    0x00, 0x00, 0x0f, 0xc1, 0xfc, 0x1f, 0xf8, 0x3f, 0xf7, 0xff, 0xe0, 0x00,
    0x00, 0x00, 0x07, 0xc3, 0xf8, 0x0f, 0xf0, 0x1f, 0xe3, 0xff, 0xc0, 0x00,
    0x00, 0x00, 0x07, 0xe7, 0xf8, 0x0f, 0xe0, 0x1f, 0xc1, 0xff, 0x80, 0x00,
    0x00, 0x00, 0x07, 0xff, 0xfc, 0x1f, 0xc0, 0x3f, 0x80, 0xff, 0x00, 0x00,
    0x00, 0x00, 0x03, 0xff, 0xfe, 0x3f, 0x80, 0x7f, 0x00, 0xfe, 0x00, 0x00,
    0x00, 0x00, 0x03, 0xff, 0xff, 0x7f, 0x00, 0xfe, 0x01, 0xfe, 0x00, 0x00,
    0x00, 0x00, 0x01, 0xff, 0x3f, 0xfe, 0x01, 0xfc, 0x03, 0xfe, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xfe, 0x1f, 0xfc, 0x03, 0xf8, 0x07, 0xff, 0x00, 0x00,
    0x00, 0x00, 0x01, 0xfc, 0x0f, 0xf8, 0x07, 0xf0, 0x0f, 0xff, 0x00, 0x00,
    0x00, 0x00, 0x03, 0xf8, 0x07, 0xf0, 0x0f, 0xe0, 0x1f, 0xdf, 0x00, 0x00,
    0x00, 0x00, 0x07, 0xfc, 0x0f, 0xf8, 0x1f, 0xc0, 0x3f, 0x9f, 0x00, 0x00,
    0x00, 0x00, 0x0f, 0xfe, 0x1f, 0xfc, 0x3f, 0x80, 0x7f, 0x1f, 0x00, 0x00,
    0x00, 0x00, 0x1f, 0xff, 0x3f, 0xfe, 0x7f, 0x00, 0xfe, 0x1f, 0x00, 0x00,
    0x00, 0x00, 0x3f, 0xbf, 0xff, 0x7f, 0xfe, 0x01, 0xfc, 0x1f, 0x00, 0x00,
    0x00, 0x00, 0x7f, 0x1f, 0xfe, 0x3f, 0xfc, 0x03, 0xf8, 0x1f, 0x00, 0x00,
    0x00, 0x00, 0xfe, 0x0f, 0xfc, 0x1f, 0xf8, 0x07, 0xf0, 0x1f, 0x00, 0x00,
    0x00, 0x01, 0xfc, 0x07, 0xf8, 0x0f, 0xf0, 0x0f, 0xe0, 0x1f, 0x00, 0x00,
    0x00, 0x03, 0xfc, 0x07, 0xf8, 0x0f, 0xe0, 0x1f, 0xc0, 0x1f, 0x00, 0x00,
    0x00, 0x07, 0xfe, 0x0f, 0xfc, 0x1f, 0xc0, 0x3f, 0x80, 0x1f, 0x00, 0x00,
    0x00, 0x0f, 0xff, 0x1f, 0xfe, 0x3f, 0x80, 0x7f, 0x00, 0x3f, 0x00, 0x00,
    0x00, 0x1f, 0xff, 0xbf, 0xff, 0x7f, 0x00, 0xfe, 0x00, 0x3e, 0x00, 0x00,
    0x00, 0x3f, 0x9f, 0xff, 0x3f, 0xfe, 0x01, 0xfc, 0x00, 0x7e, 0x00, 0x00,
    0x00, 0x7f, 0x0f, 0xfe, 0x1f, 0xfc, 0x03, 0xf8, 0x00, 0xfc, 0x00, 0x00,
    0x00, 0xfe, 0x07, 0xfc, 0x0f, 0xfe, 0x07, 0xf0, 0x00, 0xfc, 0x00, 0x00,
    0x00, 0xfc, 0x03, 0xf8, 0x07, 0xff, 0x0f, 0xe0, 0x01, 0xf8, 0x00, 0x00,
    0x00, 0xfe, 0x07, 0xfc, 0x0f, 0xff, 0x9f, 0xc0, 0x03, 0xf8, 0x00, 0x00,
    0x00, 0x7f, 0x0f, 0xfe, 0x1f, 0xff, 0xff, 0x80, 0x07, 0xf0, 0x00, 0x00,
    0x00, 0x3f, 0x9f, 0xff, 0x3f, 0x9f, 0xff, 0x00, 0x1f, 0xf8, 0x00, 0x00,
    0x00, 0x1f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0x00, 0x7f, 0xfc, 0x00, 0x00,
    0x00, 0x0f, 0xff, 0x1f, 0xfe, 0x03, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00,
    0x00, 0x07, 0xfe, 0x0f, 0xfc, 0x01, 0xff, 0xff, 0xff, 0x7f, 0x00, 0x00,
    0x00, 0x03, 0xfc, 0x07, 0xf8, 0x00, 0x7f, 0xff, 0xfc, 0x3f, 0x00, 0x00,
    0x00, 0x01, 0xfc, 0x07, 0xf0, 0x00, 0x3f, 0xff, 0xf0, 0x1f, 0x80, 0x00,
    0x00, 0x00, 0xfe, 0x0f, 0xe0, 0x00, 0x07, 0xff, 0xc0, 0x0f, 0x00, 0x00,
    0x00, 0x00, 0x7f, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x3f, 0xbf, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x1f, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x0f, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

static const lv_img_dsc_t sleep_icon = {
    .header.cf = LV_IMG_CF_INDEXED_1BIT,
    .header.always_zero = 0,
    .header.reserved = 0,
    .header.w = 96,
    .header.h = 96,
    .data_size = 1160,
    .data = sleep_icon_map,
};

bool is_sleep_screen_active(void) {
    return show_sleep_screen;
}

void set_sleep_screen_active(bool active) {
    show_sleep_screen = active;
}

void draw_sleep_screen(lv_obj_t *canvas) {
    // Draw the sleep icon centered horizontally, near top of screen
    lv_draw_img_dsc_t img_dsc;
    lv_draw_img_dsc_init(&img_dsc);
    // Center the 96px icon on the 144px wide screen: (144-96)/2 = 24
    // Draw it a bit down from the top: y=32
    lv_canvas_draw_img(canvas, 24, 32, &sleep_icon, &img_dsc);

    // Show "SLEEP" in small text below the icon
    lv_draw_label_dsc_t label_dsc;
    init_label_dsc(&label_dsc, LVGL_FOREGROUND, &quinquefive_8, LV_TEXT_ALIGN_LEFT);
    lv_canvas_draw_text(canvas, 12, 140, SCREEN_WIDTH-8, &label_dsc, "SLEEP");
}
